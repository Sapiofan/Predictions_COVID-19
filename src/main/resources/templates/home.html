<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Statistics</title>
    <script src="https://cdn.anychart.com/releases/v8/js/anychart-base.min.js"></script>
    <script src="https://cdn.anychart.com/releases/v8/js/anychart-ui.min.js"></script>
    <script src="https://cdn.anychart.com/releases/v8/js/anychart-exports.min.js"></script>
    <link href="https://cdn.anychart.com/releases/v8/css/anychart-ui.min.css" type="text/css" rel="stylesheet">
    <link href="https://cdn.anychart.com/releases/v8/fonts/css/anychart-font.min.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=IM+Fell+Great+Primer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <meta name="description" content="COVID-19 Statistic"/>

    <meta property="og:title" content="Covid-19"/>
    <meta property="og:type" content="website"/>
    <link rel="icon" th:href="@{/img/virus.png}">

    <link th:href="@{/css/general.css}" rel="stylesheet" />
    <link th:href="@{/css/world.css}" rel="stylesheet" />

    <title>World data COVID-19</title>
</head>
<body>
<div th:insert="header :: header"></div>
<article>
    <section id="brief">
        <p class="details">Up to <span th:text="${lastExistedDay}"></span>, there have been
            confirmed <span class="orange"><span th:text="${confirmedCases}"></span> cases</span>
            of <span class="green">COVID-19</span> and <span class="red"><span th:text="${confirmedDeaths}"></span>
                deaths</span>.
            For the next <span th:text="${predictionDays}"></span> days have been predicted approximately
            <span class="orange"><span th:text="${predictedCases}"></span> new cases</span>
            and <span class="red"><span th:text="${predictedDeaths}"></span> new deaths</span>.</p>
    </section>
    <section id="charts">
        <div class="flex-wrapper">
            <h3 class="dark-blue">World situation</h3>
            <div class="row">
                <div class="toggle-button-cover">
                    <div class="button-cover">
                        <div class="button b2" id="button-11">
                            <input name="type" id="type" type="checkbox" class="checkbox">
                            <div class="knobs">
                                <span>New</span>
                            </div>
                            <div class="layer"></div>
                        </div>
                    </div>
                </div>
                <div class="toggle-button-cover">
                    <div class="button-cover">
                        <div class="button b2" id="button-12">
                            <input name="quantity" id="quantity" type="checkbox" class="checkbox">
                            <div class="knobs">
                                <span>Daily</span>
                            </div>
                            <div class="layer"></div>
                        </div>
                    </div>
                </div>
                <div class="toggle-button-cover">
                    <div class="button-cover">
                        <div class="button b2" id="button-10">
                            <input name="chart-type" id="chart-type" type="checkbox" class="checkbox">
                            <div class="knobs">
                                <span>Lin</span>
                            </div>
                            <div class="layer"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="charts">
            <div class="cases-data flex-wrapper">
                <div class="info dark-blue">
                    <h1 class="cases"><span th:text="${confirmedCases}"></span></h1>
                    <h4>Confirmed cases</h4>
                    <h1 class="cases"><span th:text="${predictedCases}"></span></h1>
                    <h4>Predicted cases (up to <span th:text="${lastDate}"></span>)</h4>
                </div>
                <div class="container-area" id="line-chart-container">
                    <div id="line-chart"></div>
                </div>
            </div>
        </div>
        <div class="flex-wrapper">
            <div class="death-data">
                <div class="info dark-blue">
                    <h1 class="cases"><span th:text="${confirmedDeaths}"></span></h1>
                    <h4>Deaths</h4>
                    <h1 class="cases"><span th:text="${predictedDeaths}"></span></h1>
                    <h4>Predicted deaths (up to <span th:text="${lastDate}"></span>)</h4>
                </div>
            </div>
            <div class="container-area" id="column-chart-container">
                <div id="column-chart"></div>
            </div>
        </div>
        </div>
    </section>

    <section id="regions">
        <h1 class="regions-header">Situation by region</h1>
        <div class="region-filters">
            <div class="toggle-button-cover">
                <div class="button-cover">
                    <div class="button b2" id="button-14">
                        <input name="quantity" id="type-r" type="checkbox" class="checkbox">
                        <div class="knobs">
                            <span>New</span>
                        </div>
                        <div class="layer"></div>
                    </div>
                </div>
            </div>
            <div class="toggle-button-cover">
                <div class="button-cover">
                    <div class="button b2" id="button-15">
                        <input name="quantity" id="quantity-r" type="checkbox" class="checkbox">
                        <div class="knobs">
                            <span>Daily</span>
                        </div>
                        <div class="layer"></div>
                    </div>
                </div>
            </div>
            <div class="toggle-button-cover">
                <div class="button-cover">
                    <div class="button b2" id="button-16">
                        <input name="quantity" id="data-r" type="checkbox" class="checkbox">
                        <div class="knobs">
                            <span>Cases</span>
                        </div>
                        <div class="layer"></div>
                    </div>
                </div>
            </div>
            <div class="toggle-button-cover">
                <div class="button-cover">
                    <div class="button b2" id="button-17">
                        <input name="chart-type" id="chart-type-r" type="checkbox" class="checkbox">
                        <div class="knobs">
                            <span>Lin</span>
                        </div>
                        <div class="layer"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="region-row">
            <div class="region">
                <h3 class="region-name">Europe</h3>
                <div class="flex-wrapper">
                    <p class="region-cases red">Confirmed cases: <span th:text="${europeCases}"></span></p>
                    <p class="region-cases red" style="margin-left: 140px">Confirmed deaths: <span th:text="${europeDeaths}"></span></p>
                </div>
<!--                <div class="flex-wrapper">-->
<!--                    <p class="region-cases red">Predicted cases: <span th:text="${europePredictedCases}"></span></p>-->
<!--                    <p class="region-cases red">Predicted deaths: <span th:text="${europePredictedDeaths}"></span></p>-->
<!--                </div>-->
                <div class="container-reg" id="europe">
                    <div id="container1"></div>
                </div>
            </div>
            <div class="region">
                <h3 class="region-name">Americas</h3>
                <div class="flex-wrapper">
                    <p class="region-cases orange">Confirmed cases: <span th:text="${americaCases}"></span></p>
                    <p class="region-cases orange" style="margin-left: 140px">
                        Confirmed deaths: <span th:text="${americaDeaths}"></span></p>
                </div>
                <div class="container-reg" id="america">
                    <div id="container2"></div>
                </div>
            </div>
        </div>
        <div class="region-row">
            <div class="region">
                <h3 class="region-name">Asia</h3>
                <div class="flex-wrapper">
                    <p class="region-cases green">Confirmed cases: <span th:text="${asiaCases}"></span></p>
                    <p class="region-cases green" style="margin-left: 140px">
                        Confirmed deaths: <span th:text="${asiaDeaths}"></span></p>
                </div>
                <div class="container-reg" id="asia">
                    <div id="container3"></div>
                </div>
            </div>
            <div class="region">
                <h3 class="region-name">Oceania</h3>
                <div class="flex-wrapper">
                    <p class="region-cases blue">Confirmed cases: <span th:text="${oceaniaCases}"></span></p>
                    <p class="region-cases blue" style="margin-left: 140px">
                        Confirmed deaths: <span th:text="${oceaniaDeaths}"></span></p>
                </div>
                <div class="container-reg" id="oceania">
                    <div id="container4"></div>
                </div>
            </div>
        </div>
        <div class="region-row">
            <div class="region africa">
                <h3 class="region-name">Africa</h3>
                <div class="flex-wrapper">
                    <p class="region-cases dark-blue">Confirmed cases: <span th:text="${africaCases}"></span></p>
                    <p class="region-cases dark-blue" style="margin-left: 140px">
                        Confirmed deaths: <span th:text="${africaDeaths}"></span></p>
                </div>
                <div class="container-reg" id="africa">
                    <div id="container5"></div>
                </div>
            </div>
        </div>
    </section>
    <p class="updating">Virus Spectator 2023. Proudly created by Oleksii Lytovchenko</p>
</article>
</body>
<script type="text/javascript" th:src="@{/js/charts.js}"></script>
<script th:inline="javascript">

    /*<![CDATA[*/

    var cases = /*[[${cases}]]*/ 'default';

    var deaths = /*[[${deaths}]]*/ 'default';

    /*]]>*/

    var europe = "Europe";
    var america = "Americas";
    var asia = "Asia";
    var oceania = "Oceania";
    var africa = "Africa";
    var world = "World";

    function getWorldCases(area) {
        var array = [];
        var counter = 0;

        for (const [key, value] of Object.entries(cases)) {
            var date = [];
            date[0] = key;
            for (const [key1, value1] of Object.entries(value)) {
                if(key1 === area) {
                    date[1] = value1[0];
                    date[2] = value1[1];
                    date[3] = value1[2];
                    break;
                }
            }
            array[counter] = date;
            counter += 1;
        }

        return array;
    }

    function getWorldDeaths(area) {
        var array = [];
        var counter = 0;
        for (const [key, value] of Object.entries(deaths)) {
            var date = [];
            date[0] = key;
            for (const [key1, value1] of Object.entries(value)) {
                if(key1 === area) {
                    date[1] = value1[0];
                    date[2] = value1[1];
                    date[3] = value1[2];
                    break;
                }
            }
            array[counter] = date;
            counter += 1;
        }

        return array;
    }

    chartLine("line-chart", getWorldCases(world));
    chartLine("column-chart", getWorldDeaths(world));
    let typeOfChartLinear = true;

    chartLine("container1", getWorldCases(europe));
    chartLine("container2", getWorldCases(america));
    chartLine("container3", getWorldCases(asia));
    chartLine("container4", getWorldCases(oceania));
    chartLine("container5", getWorldCases(africa));
    let typeOfChartLinearRegion = true;

    function changeWorldChartMode(t, q) {
        $.ajax({
            type: "GET",
            url: "/changeWorld",
            dataType: "json",
            data: jQuery.param({ type: t, quantity : q}),
            complete: [
                function (response) {
                    $("#line-chart").remove();
                    $("#column-chart").remove();
                    var obj = $.parseJSON(response.responseText);
                    cases = obj[0];
                    deaths = obj[1];
                    $("#line-chart-container").append(`<div id="line-chart"></div>`);
                    $("#column-chart-container").append(`<div id="column-chart"></div>`);
                    if(typeOfChartLinear) {
                        chartLine("line-chart", getWorldCases(world));
                        chartLine("column-chart", getWorldDeaths(world));
                    } else {
                        chartColumn("line-chart", getWorldCases(world));
                        chartColumn("column-chart", getWorldDeaths(world));
                    }
                }
            ]
        });
    }

    function changeRegionChartMode(d, t, q) {
        $.ajax({
            type: "GET",
            url: "/changeWorld",
            dataType: "json",
            data: jQuery.param({type: t, quantity : q}),
            complete: [
                function (response) {
                    $("#container1").remove();
                    $("#container2").remove();
                    $("#container3").remove();
                    $("#container4").remove();
                    $("#container5").remove();
                    var obj = $.parseJSON(response.responseText);
                    cases = obj[0];
                    deaths = obj[1];
                    $("#europe").append(`<div id="container1"></div>`);
                    $("#america").append(`<div id="container2"></div>`);
                    $("#asia").append(`<div id="container3"></div>`);
                    $("#oceania").append(`<div id="container4"></div>`);
                    $("#africa").append(`<div id="container5"></div>`);

                    if(typeOfChartLinearRegion) {
                        if(d === "cases") {
                            chartLine("container1", getWorldCases(europe));
                            chartLine("container2", getWorldCases(america));
                            chartLine("container3", getWorldCases(asia));
                            chartLine("container4", getWorldCases(oceania));
                            chartLine("container5", getWorldCases(africa));
                        } else {
                            chartLine("container1", getWorldDeaths(europe));
                            chartLine("container2", getWorldDeaths(america));
                            chartLine("container3", getWorldDeaths(asia));
                            chartLine("container4", getWorldDeaths(oceania));
                            chartLine("container5", getWorldDeaths(africa));
                        }
                    } else {
                        if(d === "cases") {
                            chartColumn("container1", getWorldCases(europe));
                            chartColumn("container2", getWorldCases(america));
                            chartColumn("container3", getWorldCases(asia));
                            chartColumn("container4", getWorldCases(oceania));
                            chartColumn("container5", getWorldCases(africa));
                        } else {
                            chartColumn("container1", getWorldDeaths(europe));
                            chartColumn("container2", getWorldDeaths(america));
                            chartColumn("container3", getWorldDeaths(asia));
                            chartColumn("container4", getWorldDeaths(oceania));
                            chartColumn("container5", getWorldDeaths(africa));
                        }
                    }
                }
            ]
        });
    }
</script>
</html>